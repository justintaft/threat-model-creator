{"version":3,"sources":["threatmodeler/core.cljs"],"mappings":"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","names":["threatmodeler.core/html-element->element-id","element","threatmodeler.core/threat-examples","threatmodeler.core/create-lookup-from-vector-of-hashmaps","id-function","hashmap","cljs.core.into","cljs.core.map","cljs.core.juxt","cljs.core/identity","threatmodeler.core/threat-element-property-groups","cljs.core.atom","threatmodeler.core/add-threat-element-property-group!","group-name","scenarios","cljs.core.swap_BANG_","x","scenario-ids","cljs.core.update_in","cljs.core/conj","cljs.core/merge","threatmodeler.core/app-state","reagent.core.atom","threatmodeler.core/ui-state","reagent.core/cursor","threatmodeler.core/threat-model","threatmodeler.core/toggle-value-in-set","input-set","value","fexpr__26680","cljs.core/contains?","cljs.core/disj","threatmodeler.core/property-id->property","property-id","cljs.core/deref","cljs.core.get_in","threatmodeler.core/property-ids-to-threat-ids","property-ids","cljs.core/flatten","cljs.core.apply","clojure.set/union","threatmodeler.core/update-element-threat-ids-from-property-ids","threat-ids","cljs.core/assoc-in","js/threatmodeler","js/threatmodeler.core","js/threatmodeler.core.create-base-element","method-table__4672__auto__","prefer-table__4673__auto__","method-cache__4674__auto__","cached-hierarchy__4675__auto__","hierarchy__4676__auto__","cljs.core.get","fexpr__26681","cljs.core/MultiFn","cljs.core.symbol","threatmodeler.core/create-base-element","d","cljs.core.merge","cljs.core/random-uuid","threatmodeler.core/create-element","data","threatmodeler.core/add-element","app-state","threatmodeler.core/toggle-element-property-for-element","element-id","updated-property-ids","updated-threat-ids","threatmodeler.core/toggle-element-property-for-element!","property","threatmodeler.core/add-element!","threatmodeler.core/filter-elements-referencing-element-id","cljs.core/set","cljs.core/vals","cljs.core/select-keys","threatmodeler.core/delete-element-and-communications","referencing-elements","cljs.core.filter","cljs.core.partial","referencing-element-ids","cljs.core/dissoc","js/threatmodeler.core.delete-element","fexpr__26682","threatmodeler.core/delete-element","threatmodeler.core/set-active-moveable-element!","id","e","cljs.core/assoc","threatmodeler.core/moveable","reagent.core/adapt-react-class","js/module$node_modules$react_moveable$dist$moveable_cjs","threatmodeler.core/calculate-line-points","element1","element2","p__26683","map__26684","cljs.core/PROTOCOL_SENTINEL","cljs.core/hash-map","threatmodeler.core/render-line","x1","y1","x2","y2","style","line","lineLength","js/Math.sqrt","js/Math.pow","slope","rotationDegree","js/Math.PI","js/Math.atan","or__4185__auto__","js/goog.string.format","threatmodeler.core/get-closest-html-element","selector","threatmodeler.core/diagram-element-event-on-mouse-up!","state","last-item-shift-clicked","p__26686","map__26687","threatmodeler.core/render-threat-model-element-common","y","type","name","rotate","cljs.core/name","threatmodeler.core/handle-backspace-pressed!","temp__5735__auto__","current-element-id","current-element","threatmodeler.core/handle-enter-pressed!","js/prompt","threatmodeler.core/render-threat-model-element-communication","elements","threatmodeler.core/render-threat-model-element-boundary","js/threatmodeler.core.render-threat-model-element","fexpr__26689","threatmodeler.core/render-threat-model-element","_","threatmodeler.core/toolbar","threatmodeler.core/diagram-event-element-drag-stop","event","cljs.core/update-in","threatmodeler.core/moveable-on-rotate-start!","active-element-id","cur-element-rotation","threatmodeler.core/moveable-on-rotate!","element-info","rotate-amount","threatmodeler.core/moveable-rotate-end!","threatmodeler.core/moveable-drag-start!","cur-element-info","threatmodeler.core/moveable-drag-on!","last-element-dragged-deref","newX","newY","threatmodeler.core/moveable-drag-end!","ui-state-derefed","cur-val","threatmodeler.core/instructions","threatmodeler.core/render-threat-element-property-groups","property-groups","active-element","cljs.core.doall","iter__4582__auto__","s__26692","cljs.core/LazySeq","cljs.core/seq","cljs.core/chunked-seq?","c__4580__auto__","size__4581__auto__","cljs.core/count","b__26694","cljs.core/chunk-buffer","i__26693","vec__26695","cljs.core/-nth","cljs.core.nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__26691","cljs.core/chunk-rest","vec__26702","cljs.core/first","cljs.core/cons","cljs.core/rest","s__26699","b__26701","i__26700","iter__26698","s__26706","b__26708","i__26707","iter__26705","p1__26690#","threatmodeler.core/threat-search","threatmodeler.core/threat-table","active-threat-id","s__26710","b__26712","i__26711","iter__26709","threat-id","threat-info","threatmodeler.core/active-element-name","threatmodeler.core/simple-example","threat-model","s__26714","b__26716","i__26715","iter__26713","js/document.querySelector","reagent-keybindings.keyboard/keyboard-listener","reagent-keybindings.keyboard/kb-action","threatmodeler.core/main!","reagent.dom.render","js/document.getElementById","cljs.core/chunk-first"],"sourcesContent":["(ns threatmodeler.core\n  (:require [reagent.core :as r]\n            [reagent.dom :as rdom]\n            [clojure.string :as str]\n            [goog.string.format]\n            [react-moveable :as Moveable]\n            [cljs.test :refer-macros [deftest is testing]]\n            [reagent-keybindings.keyboard :as kb]\n            [clojure.set]))\n\n(defn html-element->element-id [element]\n  (-> element .-dataset .-elementId))\n\n(def threat-examples\n  {\n\n   :encrypt-or-sign-data {:description \"Weak cryptography is used, allowing communications to be forged or decrypted.\" :mitigation \"Use a vetted cryptographic library, such as libsodium, which handles cryptographic operations. Avoid creating or implementing own cryptographic routines, as a wide range of attacks against.\"}\n   :docker {:description \"Root file system is mounted within docker container, allowing host to be compromised.\" :mitigation \"Limit file system exposed to docker.\"}\n   :command-launching {:description \"Attacker can influence applications/command arguments.\" :mitigation \"Whenever possible, don't allow the attacker to specify the actual application to run. Validate and sanitize user input. Do not use string concatenation/formatting to build command strings.\"}\n   :race-condition {:description \"Attacker performs multiple operations simultaneously, causing the application to perform unwanted behavior.\" :mitigation \"If possible, perform action synchronously to prevent unwanted side-effects. For example, database/memory transactions and locks can be used to prevent sumptuously updating of sensitive data.\"}\n   :memory-corruption {:description \"Memory corruption/disclosure vulnerability exists, allowing attacker to influence application or access sensitive data.\" :mitigation \"Use static analysis, such as by leveraging compiler flags, to detect vulnerable code patterns. If possible, avoid or minimize using languages where memory safety is hard to achieve. Whenever possible, use memory-corruption mitigation's such as ASLR, DEP, and Stack Cookies. Perform fuzzing on applications to discover vulnerabilities.\"}\n   :weak-reset-password-flow {:description \"Attacker compromise password reset flows through weak processes (SIM Hijacking/SS7 Spoofing to aquire SMS messages, insufficient amount of entropy in reset links, etc.)\" :mitigation \"Generate password reset links which contain a large amount of entropy, such as 128 bits.\"}\n   :connected-to-network {:description \"Host is connected to a network, exposing network devices to internet.\"  :mitigation \"Add firewall rules to restrict inbound and output traffic.\"}\n   :machine-learning-taint-data {:description \"Attacker can influence training data.\" :mitigation \"Review and assign trust-worthiness to data to avoid malicious tainting of data.\"}\n   :machine-learning-train-against-model {:description \"Attacker uses application to train their own models.\" :mitigation \"Add rate limiting. Returning fuzzy data may be performed.\"} \n   :session-generation {:description \"Session IDs can be brute-forced, or recovered due to being generated weakly.\" :mitigation \"Ensure sessions are generated from a cryptographically secure random number generator, which contain a sufficient amount of entropy, such as 128 bits.\"}\n   :session-fixation {:description \"Attacker forces target user to authentication under an attacker-controlled account. Attackers may modify URLs which accept authentication id/tokens to force authenticate users. Attacker may force users submit login forms to authentication as the attacker too.\" :mitigation  \"Verify authenticator with requests, such as with anti Cross-Site Request Forgery tokens.\"}\n   :third-party-components {:description \"Attacker breaks in to system due to vulnerabilities in third party components.\" :mitigation \"Keep third-party components up to date with latest security patches. Ensure trusted components are used. If untrusted components ar required, consider sandboxing the components from accessing sensitive data.\"} \n   :backup {:description \"Data is deleted or corrupted.\" :mitigation \"Backup data. Ensure a recovery process is created and tested a-head of time before needed. Backing up data to a remote locaiton is highly recommended.\"}\n   :db-injection {:description \"Queries are constructed from user data.\" :mitigation \"User  queries. Avoid using string concatenation with database queries and user input. Note data may be possible to  be coerced into arrays or hashmaps by the web server. For NoSQL queries, this can lead to injection of inequality statements.\"}\n   :cookies {:description \"User authenticates with cookies.\" :mitigation \"Use cookie security flags to protect information (SameSite,HTTPOnly,Secure)\"}\n   :content-over-http {:description \"User Connects Over HTTP\" :mitigation \"Configure HSTS Reloading. Return Strict Transport Security header, and include sub domains. Redirect HTTP to HTTPS.\"}\n   :xxs {:description \"Application displays user supplied data\" :mitigation \"Encode user input for the appropriate context it appears in (HTML, JavaScript, etc.). Configure Content Security Policies to mitigate processing and communicating with untrusted resources and hosts.\"}\n   :sensitive-data {:description \"Sensitive Information is stored (PII, Password Hashes etc.)\" :mitigation \"Encrypt sensitive data. Use a vetted cryptography library/service when possible, such as libsodium. Ensure the chosen library makes use of strong cryptography (uses non-broken cryptographic algorithm,  generates keys using a CSRPNG, does not re-use IVs, facilities key rotations, etc.)\"}\n   :cleartext-password-storage  {:description \"Database contains credentials.\"  :mitigation \"Use a cryptographically secure hashing algorithm to hash passwords, such as scrypt.\"} \n   :xxe {:description \"User supplied XML is processed, or xpaths are supplied.\" :mitigation \"Disable Document Type Definition (DTD) parsing and external entity resolving when possible. If XPaths generated from user input is required, use an XPath library which properly encodes user input.\"}\n   :file-uploads {:description \"Users can upload files.\" :mitigation \"If files are saved to disk, perform path canonicalization on files and ensure target file is under expected directory and path. Restrict what type of data can be uploaded. If users can download files, set the appropriate mime-type presenting the data. Avoid allowing executable to be uploaded.\"}\n   :serialization {:description \"User supplied data is deserialized\" :mitigation \"Use a secure serialization framework/library which can not be leveraged to deserialize arbitrary types (Ex, Avoid BinaryFormatter in .NET). Validate user supplied data to avoid mass assignment vulnerabilities.\"} \n   :tls {:description \"Sensitive data transferred over the network.\" :mitigation \"Use Transport Layer Security to secure communications. Ensure strong cipher-suites and parameters are used.\"}\n   :password-complexity {:description \"Users can choose weak passwords.\" :mitigation \"Define and enforce a password complexity policy.\"}\n   :jwt {:description \"User authentications with JWT token.\" :mitigation \"Ensure algorithm \\\"none\\\" is not supported. Ensure users can't mix key material with algorithms (ie, use a public key as HMAC secret.)\"}\n   :deauthentication {:description \"User can't sign out.\" :mitigation \"Determine appropriate amount of time for sessions to time out. When a user clicks sign out, contact the remote service terminate the user's session. Ensure that the session id/token can't be used supplied to authentication with the remote service.\"} \n   :authentication {:description \"Session identifiers are used to identify users.\" :mitigation \"Generation Session IDs form a cryptographically secure source, such as a CSRPNG. Ensure the length of session IDs are not brute-forceable, such as 128 bits of entropy in length.\"}\n   :smb {:description \"NTLM hases are leaked to attackers due to processing malicious URIs\"  :mitigation \"Block outbound SMB traffic, if possible. Set the policy \\\"Network Security: Restrict NTLM: Outgoing NTLM traffic to remote servers\\\" to deny all.\"}\n   :mobile {:description \"Application preview images, such as those shown when switching applications, may disclose sensitive data.\" :mitigation \"When the app is notified it will lose focus, overlay the application view with non-sensitive image, such as a banner.\"}\n   :linux-proc {:description \"Application is exploited to return contents of /proc/self/mem, or other sensitive proc files.\" :mitigation \"Mount proc with a hidepid value of 2. Ensure processes are not run as root.\"}\n   :desktop-application {:description \"Application is exploited, allowing access to user files.\" :mitigation \"Leverage OS APIs to sandbox the application. See https://chromium.googlesource.com/chromium/src/+/master/docs/design/sandbox.md for examples.\"}})\n\n\n(defn create-lookup-from-vector-of-hashmaps [id-function hashmap]\n  (into {} (map (juxt id-function identity) hashmap)))\n\n(def threat-element-property-groups (atom {:groups [] :scenarios {}}))\n(defn add-threat-element-property-group!\n  \"Creates lookup of groups and scenarios\"\n  [group-name scenarios]\n  (swap! threat-element-property-groups\n         (fn [x]\n           (let [scenario-ids (map :id scenarios)]\n             (-> (update-in x [:groups] conj [group-name scenario-ids])\n                 (update-in [:scenarios] merge (create-lookup-from-vector-of-hashmaps :id scenarios)))))))\n\n(add-threat-element-property-group!\n \"Application Type, Language, OS\"\n [{:id :web-application          :name \"Web Application\" :threats #{:content-over-http :xxs}}\n  {:id :unsafe-memory-components :name \"Unsafe Memory Components (C,C++,Unsafe Rust, Java JNI\" :threats #{:memory-corruption}}\n  {:id :desktop-application      :name \"Desktop Application\" :threats #{:desktop-application}}\n  {:id :mobile-application       :name \"Mobile Application\" :threats #{:mobile}}\n  {:id :windows                  :name \"Windows\" :threats #{:smb}}\n  {:id :linux                    :name \"Linux\" :threats #{:linux-proc}}])\n\n(add-threat-element-property-group!\n \"Data Processing\"\n [{:id :file-upload :name \"File Upload\" :threats #{:file-uploads}}\n  {:id :deserialize :name \"Deserialize Data\" :threats #{:serialization}}\n  {:id :parses-xml  :name \"Parses XML\" :threats #{:xxe}}\n  {:id :display-user-input-as-html :name \"Display User Input as HTML/Scripts\" :threats #{:xxs}}\n  {:id :run-system-commands :name \"Run System Commands\" :threats #{:command-launching}}\n  {:id :db-injection :name \"Database Queries\" :threats #{:db-injection}}\n  {:id :machine-learning :name \"Machine Learning\" :threats #{:machine-learning-taint-data :machine-learning-train-against-model}}\n  {:id :race-condition :name \"Sensitive to Ordering of Operations\" :threats #{:race-condition}}])\n\n(add-threat-element-property-group!\n \"Authentication\"\n [{:id :oauth :name \"OAuth\" :threats #{:session-fixation}}\n  {:id :jwt :name \"JWT\" :threats #{:jwt :deauthentication :session-fixation}}\n  {:id :cookies :name \"Cookies\" :threats #{:cookies :deauthentication :session-fixation}}\n  {:id :session-ids :name \"Session Ids\" :threats #{:session-generation :deauthentication :session-fixation}}\n  {:id :username-and-passwords :name \"Username and Passwords\" :threats #{:password-complexity :weak-reset-password-flow}}])\n\n(add-threat-element-property-group!\n \"Cryptography\"\n [{:id :encrypts :name \"Encrypts or Signs Data\" :threats #{:encrypt-or-sign-data}}])\n\n(add-threat-element-property-group!\n \"Misc\"\n [{:id :third-party-components :name \"Third Party Components\" :threats #{:third-party-components}}\n  {:id :docker :name \"Docker\" :threats #{:docker}}\n  {:id :processes-network-traffic :name \"Connected To Network\" :threats #{:connected-to-network}}\n  {:id :important-data :name \"Stores Important Data\" :threats #{:backup}}\n  {:id :sensitive-data :name \"Stores Sensitive Data\" :threats #{:sensitive-data}}\n  {:id :stores-credentials :name \"Stores credentials\" :threats #{:cleartext-password-storage}}\n  ])\n\n(def app-state (r/atom {:ui-state {:active-diagram-element-id nil\n                                   :element-transformation-in-progress nil\n                                   :last-element-dragged nil\n                                   :last-item-shift-clicked nil}\n                        :threat-model {:elements {} :threats []}}))\n\n(def ui-state (r/cursor app-state [:ui-state]))\n(def threat-model (r/cursor app-state [:threat-model]))\n\n\n(defn toggle-value-in-set [input-set value]\n  ((if (contains? input-set value) disj conj) input-set value))\n\n(defn property-id->property [property-id]\n  (get-in @threat-element-property-groups [:scenarios property-id]))\n\n(defn property-ids-to-threat-ids [property-ids]\n  (->> (map property-id->property property-ids)\n       (map :threats)  \n       (flatten)\n       (apply clojure.set/union)))\n\n(defn update-element-threat-ids-from-property-ids [element]\n  (let [threat-ids (property-ids-to-threat-ids (:properties element))]\n    (assoc-in element [:threats] threat-ids)))\n\n\n;TODO add validation to ensure only valid properties are provided\n(defmulti create-base-element :type)\n(defmethod create-base-element :actor          [d] (merge {:id (str (random-uuid)) :name \"TODO\" :width 100 :height 50 :x 100 :y 100 :properties #{}} d))\n(defmethod create-base-element :process        [d] (merge {:id (str (random-uuid)) :name \"TODO\" :width 100 :height 100 :x 100 :y 100 :properties #{}} d))\n(defmethod create-base-element :datastore      [d] (merge {:id (str (random-uuid)) :name \"TODO\" :width 100 :height 50 :x 100 :y 100 :properties #{}} d))\n(defmethod create-base-element :boundary       [d] (merge {:id (str (random-uuid)) :width 100 :height 20 :x 100 :y 100 :properties #{}} d))\n(defmethod create-base-element :communication  [d] (merge {:id (str (random-uuid)) :properties #{}} d))\n\n(defn create-element  [data]\n  (update-element-threat-ids-from-property-ids (create-base-element data)))\n\n\n\n\n\n\n(defn add-element [app-state data]\n  \"Add an element to the given app state.\"\n  (let [element (create-element data)]\n    (assoc-in app-state [:threat-model :elements (:id element)] element)))\n\n(defn toggle-element-property-for-element [app-state element-id property-id]\n  (let [updated-property-ids (toggle-value-in-set (get-in app-state [:threat-model :elements element-id :properties]) property-id)\n        updated-threat-ids (property-ids-to-threat-ids updated-property-ids)]\n    (-> (assoc-in app-state [:threat-model :elements element-id :properties] updated-property-ids)\n        (assoc-in [:threat-model :elements element-id :threats] updated-threat-ids))))\n\n\n\n(defn toggle-element-property-for-element!\n  \"Adds threats to a given element\"\n  [element-id property]\n  (swap! app-state toggle-element-property-for-element element-id (:id property)))\n\n(defn add-element! \n  \"Adds element to threat model, and udpates corresponding atom.\"\n  [data]\n  (let [element (create-element data)]\n    (swap! app-state add-element data)))\n\n\n  (defn filter-elements-referencing-element-id [element-id element]\n  \"Return elements which directly references element.\"\n  (contains? (set (vals (select-keys element [:to :from :id]))) element-id ))\n\n(defn delete-element-and-communications\n  \"Deletes element from threat model, and any communications referencing it\"\n  [app-state element]\n  (let [referencing-elements (filter (partial filter-elements-referencing-element-id (:id element)) (-> app-state :threat-model :elements (vals)))\n        referencing-element-ids (map :id referencing-elements)]\n    (update-in app-state [:threat-model :elements] (fn [x] (apply dissoc x app-state referencing-element-ids)))))\n  (defmulti delete-element (fn [app-state element] (:type element)))\n  (defmethod delete-element :communication [app-state element] (update-in app-state [:threat-model :elements] dissoc (:id element)))\n  (defmethod delete-element :default [app-state element] (delete-element-and-communications app-state element))\n             \n\n  ;Populate threat model with example data\n(add-element! (create-element {:type :actor         :name \"Web User\" :x 50  :y 150 :id \"webuser\" :properties #{:username-and-passwords}}))\n(add-element! (create-element {:type :process       :name \"webapp\"    :x 300 :y 125 :id \"webapp1\" :properties #{:file-upload}}))\n(add-element! (create-element {:type :datastore     :name \"database\"  :x 300  :y 300 :id \"datastore1\" :properties #{:sensitive-data :important-data } }))\n(add-element! (create-element {:type :communication :from \"webuser\" :to \"webapp1\" :name \"communication1\" :threats #{:tls}}))\n(add-element! (create-element {:type :communication :from \"webapp1\" :to \"datastore1\" :name \"communication2\" :threats #{:tls}}))\n(add-element! (create-element {:type :boundary :name \"boundary1\"}))\n\n(defn set-active-moveable-element!\n\"Sets the active element which can be moved and dragged around.\nIf an item is currently being transformed, the active element is not updated.\"\n\n  [id e]\n  (when-not (:element-transformation-in-progress @ui-state)\n  (swap! ui-state assoc :active-diagram-element-id id)))\n\n\n\n  (def moveable (r/adapt-react-class Moveable))\n\n  (defn calculate-line-points [element1 element2]\n  \"Find best line between two elements, and return points.\"\n\n(cond\n                                        ;left of second element\n  (< (+ (:x element1) (:width element1)) (:x element2))\n  {:x1 (+ (:x element1) (:width element1))\n   :y1 (+ (:y element1) (/ (:height element1) 2))\n   :x2 (:x element2)\n   :y2 (+ (:y element2) (/ (:height element2) 2))}\n\n                                        ;to right of second element\n  (> (:x element1) (+ (:x element2) (:width element2)))\n  {:x1 (+ (:x element2) (:width element2))\n   :y1 (+ (:y element2) (/ (:height element2) 2))\n   :x2 (:x element1)\n   :y2 (+ (:y element1) (/ (:height element1) 2))}\n\n\n                                        ;above second element\n  (< (:y element1) (:y element2))\n  {:x1 (+ (:x element1) (/ (:width element1) 2))\n   :y1 (+ (:y element1) (:height element1))\n   :x2 (+ (:x element2) (/ (:width element2) 2))\n   :y2 (:y element2)}\n\n\n                                        ;below second elements\n  true\n  {:x1 (+ (:x element2) (/ (:width element2) 2))\n   :y1 (+ (:y element2) (:height element2))\n   :x2 (+ (:x element1) (/ (:width element1) 2))\n   :y2 (:y element1)}))\n\n\n\n\n\n\n\n\n(defn render-line [ {:keys [x1 y1 x2 y2 style id] :as line}]\n(let [lineLength (js/Math.sqrt (+ (js/Math.pow (- x2 x1) 2)\n                                  (js/Math.pow (- y2 y1) 2)))\n\n      slope (/ (- y1 y2) (- x1 x2))\n\n\n                                        ;We have to do some funky math to rotations, as Y is inverted on screen\n                                        ;(higher Y cord is lowe ron screen...)\n      rotationDegree (if (and (>= x1 x2)\n                              (< y1 y2))\n                       (- js/Math.PI   (* -1 (js/Math.atan slope)))\n                       (js/Math.atan slope))\n      style (or style \"solid\")]\n  \n\n  [:div.line.diagram-threat-model-element {:style {:height \"2px\"\n                                                   :width (goog.string.format \"%dpx\" lineLength)\n                                                   :border-top (goog.string.format \"2px %s black\" style)\n                                                   :transform (goog.string.format \"translate(%dpx,%dpx) rotate(%frad)\" x1 y1 rotationDegree)\n                                                   :transform-origin \"center left\"\n                                                   :padding (if (:draggable line) \"5px\" \"0\")}\n\n                                           :data-element-id id\n                                           :class (str \"moveable-element-\" id)\n                                           :on-mouse-over (partial set-active-moveable-element! id)}]))\n\n\n(defn get-closest-html-element \n  \"Given a HTML element and selector, find the closest node to it.\n   If the selector matches the given node, return the curret node.\"\n  [element selector]\n  (.closest element selector))\n\n(defn diagram-element-event-on-mouse-up! \n  \"Handles on mouse up event for diagram elements.\n   Used to connect diagram elements together when shift key is \n   held while clicking elements.\"\n\n  [element-id e]\n  (when e.shiftKey\n    (swap! app-state\n           (fn [state]\n             (let [last-item-shift-clicked (-> state :ui-state :last-item-shift-clicked)]\n\n                                        ;When we have a item we previously shift-clicked, connect the elements together\n                                        ;and forger the last element clicked\n               (if last-item-shift-clicked\n                 (-> (add-element state {:type :communication :from last-item-shift-clicked :to element-id})\n                     (assoc-in [:ui-state :last-item-shift-clicked] nil))\n\n                                        ;If we haven't previously shift-clicked an item, just remember it\n                 (assoc-in state [:ui-state :last-item-shift-clicked] element-id)))))))\n\n\n(defn render-threat-model-element-common [{:keys [x y type name id rotate]}]\n  [:span.diagram-threat-model-element {:class (str \"diagram-\" (cljs.core/name type)\n                                                   \" moveable-element-\" id)\n                                       :style {:transform (goog.string.format \"translate(%dpx,%dpx) rotate(%ddeg)\" x y (or rotate 0))}\n                                       :data-element-id id\n                                       :on-mouse-up (partial diagram-element-event-on-mouse-up! id)\n                                       :on-mouse-over (partial set-active-moveable-element! id)}\n   [:p name]])\n\n\n(defn handle-backspace-pressed! []\n  \"Handles backspace key event. Causes element to be deleted.\"\n  (when-let [current-element-id (get-in @app-state [:ui-state :active-diagram-element-id])]\n    (when-let [current-element (get-in @app-state [:threat-model :elements current-element-id])]\n      (swap! app-state delete-element current-element))))\n\n(defn handle-enter-pressed! []\n  \"Handles pressing over enter key for diagram elements. Used to re-name element.\"\n  (when-let [current-element-id (get-in @app-state [:ui-state :active-diagram-element-id])]\n    (when-let [current-element (get-in @app-state [:threat-model :elements current-element-id])]\n      (swap! app-state assoc-in [:threat-model :elements current-element-id :name] (js/prompt \"Element name:\" (:name current-element))))))\n\n(defn render-threat-model-element-communication [element elements]\n  [render-line (merge (select-keys element [:id]) (calculate-line-points (get elements (:from element)) (get elements (:to element))))])\n\n(defn render-threat-model-element-boundary [element elements]\n  [render-line (merge element {:style \"dashed\" :draggable true})])\n\n(defmulti render-threat-model-element (fn [element _] (:type element)))\n(defmethod render-threat-model-element :actor [element] (render-threat-model-element-common element))\n(defmethod render-threat-model-element :process [element] (render-threat-model-element-common element))\n(defmethod render-threat-model-element :datastore [element] (render-threat-model-element-common element))\n(defmethod render-threat-model-element :communication [element elements] (render-threat-model-element-communication element elements))\n(defmethod render-threat-model-element :boundary [element ] (render-threat-model-element-common element))\n\n\n(defn toolbar []\n  [:div\n   [:button {:on-click #(add-element! (create-element {:type :actor :x 100 :y 100}))} \"Add Actor\"]\n   [:button {:on-click #(add-element! (create-element {:type :process :x 100 :y 300 }))} \"Add Process\"]\n   [:button {:on-click #(add-element! (create-element {:type :datastore :x 100 :y 100}))} \"Add Datastore\"]\n   [:button {:on-click #(add-element! (create-element {:type :boundary :x 100 :y 100 }))} \"Add Trust Boundary\"]])\n\n(defn diagram-event-element-drag-stop [id event data]\n  \"Persist position of dragged threat model diagram element to local state.\"\n  (swap! threat-model update-in [:elements id] merge {:x (-> data .-lastX) :y (-> data .-lastY)}))\n\n\n(defn moveable-on-rotate-start! [event]\n  \"Callback handler for starting of rotation. Sets rotation degree to current element rotation.\"\n  (let [active-element-id (html-element->element-id (-> event .-target))\n        cur-element-rotation (get-in @app-state [:threat-model :elements active-element-id :rotate])]\n    (swap! ui-state\n           merge\n           {:active-diagram-element-id active-element-id\n            :element-transformation-in-progress true\n            :orig-rotate cur-element-rotation})))\n\n(defn moveable-on-rotate! [event]\n  (let [active-element-id (-> @app-state :ui-state :active-diagram-element-id)\n        element-info (get-in @app-state [:threat-model :elements active-element-id])\n        rotate-amount (+ (-> @app-state :ui-state :orig-rotate) (int (-> event .-beforeRotate)))]\n    (swap! app-state assoc-in [:ui-state :rotate-amount] rotate-amount)\n    (set! (-> event .-target .-style .-transform) (goog.string.format \"translate(%dpx,%dpx) rotate(%ddeg)\" (:x element-info) (:y element-info) rotate-amount))))\n\n\n(defn moveable-rotate-end! [event]\n  \"Callback handler for finishing rotating element. Persists rotated degree to element.\"\n  (swap! app-state\n         (fn [state]\n           (let [element-id (html-element->element-id (-> event .-target))\n                 rotate-amount (-> state :ui-state :rotate-amount)]\n             (-> (assoc-in state [:threat-model :elements element-id :rotate] rotate-amount)\n                 (assoc-in [:ui-state :element-transformation-in-progress] nil))))))\n\n\n(defn moveable-drag-start! [event]\n  (let [element-id (html-element->element-id (-> event .-target))\n        cur-element-info (get-in @threat-model [:elements element-id])]\n    (swap! ui-state\n           merge\n           {:element-transformation-in-progress true\n            :rotate 0}\n           (select-keys cur-element-info [:x :y :rotate])\n           {:newX (:x cur-element-info) :newY (:y cur-element-info)})))\n\n(defn moveable-drag-on! [event]\n  (let [last-element-dragged-deref @ui-state\n        newX (+ (:x last-element-dragged-deref) (-> event .-left))\n        newY (+ (:y last-element-dragged-deref) (-> event .-top))\n        rotate (or (:rotate last-element-dragged-deref) 0)\n        element-id (:active-diagram-element-id  last-element-dragged-deref)]\n    (swap! ui-state merge {:newX newX :newY newY})\n    (set! (-> event .-target .-style .-transform) (goog.string.format \"translate(%dpx,%dpx) rotate(%ddeg)\" newX newY rotate))))\n\n(defn moveable-drag-end! []\n  (let [ui-state-derefed @ui-state]\n    (swap! threat-model\n           update-in\n           [:elements (:active-diagram-element-id ui-state-derefed)]\n           (fn [cur-val]\n             (merge cur-val\n                    {:x (:newX ui-state-derefed)\n                     :y (:newY ui-state-derefed)}))))\n  (swap! ui-state assoc :element-transformation-in-progress nil))\n\n(defn instructions []\n  [:div\n   [:p \"Controls\"\n    [:br]\n    \"Connect element: Shift-click two elements to connect elements\"\n    [:br]\n    \"Delete element: Move mouse over element and press backspace key\"\n    [:br]\n    \"Rename-element: Move mouse over element and press enter key\"]])\n\n(defn render-threat-element-property-groups [element-id property-groups]\n  (let [active-element (get-in @threat-model [:elements element-id])]\n    [:div.threat-element-property-groups \n     (doall\n      (for [[group-name scenario-ids] (:groups property-groups)]\n        [:div.checklist-with-header\n         [:h5 group-name]\n         [:ul\n                                        ;Get scenarios structures from scenario ids\n          (doall\n           (for [property (map #(get-in property-groups [:scenarios %1]) scenario-ids)] \n             [:li\n              [:input {:type \"checkbox\"\n                       :name (:name property)\n                       :id (:id property)\n                       :checked (contains? (-> active-element :properties) (:id property))\n                       :on-change #(toggle-element-property-for-element! element-id property )}]\n              [:label {:for (:id property)} (:name property)]]))]]))]))\n  \n\n(defn threat-search []\n  [:div\n   [:input {:placeholder \"What\"}]])\n\n(defn threat-table [active-threat-id]\n(let [active-element (get-in @threat-model [:elements active-threat-id])]\n  [:table#threat-table\n   [:tr\n    [:th \"Description\"]\n    [:th \"Mitigation\"]]\n   (doall\n    (for [threat-id (:threats active-element)]\n      (let [threat-info (threat-examples threat-id)]\n        [:tr \n         [:td (-> threat-info :description)]\n         [:td (-> threat-info :mitigation)]])))]))\n\n(defn active-element-name [active-threat-id]\n  (let [active-element (get-in @threat-model [:elements active-threat-id])]\n    [:div#threats-for\n     [:h5.section-label \"Threats for:\"]\n     [:h3.threat-name (:name active-element)]]))\n\n(defn simple-example [threat-model]\n  [:div#main\n   [:div#graph-area\n    [instructions]\n    [toolbar]\n    [:div#diagram \n                                        ;Doall is required here, as for generates lazy sequence, and \n                                        ;derefs in child components won't trigget updates. known reagent issue.\n     (doall (for [element (vals (:elements @threat-model))]\n              (render-threat-model-element element (:elements @threat-model))))\n     [moveable {:target (js/document.querySelector (str \".moveable-element-\" (-> @ui-state :active-diagram-element-id)))\n                :draggable true\n                                        ;Drag x and y in steps of 25 points\n                :throttleDrag 25 \n                :throttleRotate 15 \n                :onDragStart moveable-drag-start!\n                :onDrag moveable-drag-on! \n                :snappable true\n                :rotatable true\n                :onDragEnd moveable-drag-end!\n                :onRotateStart moveable-on-rotate-start!\n                :onRotate moveable-on-rotate!\n                :onRotateEnd moveable-rotate-end!}]\n     [kb/keyboard-listener]\n     [kb/kb-action \"backspace\" handle-backspace-pressed!]\n     [kb/kb-action \"enter\" handle-enter-pressed!]]]\n   [:div#threat-input-area\n    (if (-> @ui-state :active-diagram-element-id)\n      [:div\n       [active-element-name (-> @ui-state :active-diagram-element-id)]\n       [render-threat-element-property-groups (-> @ui-state :active-diagram-element-id) @threat-element-property-groups]\n       [threat-table (-> @ui-state :active-diagram-element-id)]]\n      [:h1 \"Select an element.\"])]])\n    \n(defn ^:export main! [])\n\n(rdom/render [simple-example threat-model] (js/document.getElementById \"app\"))\n"]}